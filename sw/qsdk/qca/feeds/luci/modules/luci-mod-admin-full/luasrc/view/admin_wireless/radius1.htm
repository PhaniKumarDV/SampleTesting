<%#
 Copyright 2008-2009 Steven Barth <steven@midlink.org>
 Copyright 2008-2015 Jo-Philipp Wich <jow@openwrt.org>
 Licensed to the public under the Apache License 2.0.
-%>

<%-
        function uciget(cmd)
                local res = luci.util.exec(cmd)
                local str = string.gsub(res, "\n", "")
                return str
        end
-%>
<%+header%>
<div class="page-content">
<script type="text/javascript" src="<%=resource%>/cbi.js"></script>
<script type="text/javascript">
var def = new Array(8);
function save_def_value()
{
    var f = document.formTable;
    for (i=0; i<f.elements.length; i++)
    {
        def[i] = f.elements[i].value;
    }
}

function disable_spin()
{
    document.getElementById("spin").innerHTML = "";
}

function save_value()
{
    document.getElementById("spin").innerHTML = "<i class='fa fa-spinner fa-pulse'></i>";
    setTimeout("disable_spin()",1000);
    var setdata = "";
    var f = document.formTable;
    for( i=0; i<f.elements.length; i++)
    {
        if( def[i] != f.elements[i].value ) {
            def[i] = f.elements[i].value;
            setdata += f.elements[i].name + "=" + f.elements[i].value + "~";
        }
    }
    XHR.get('<%=luci.dispatcher.build_url("admin")%>/cfg_set' + '/' + setdata, null,
	    function(x, data) {
		    if (data) { 
		    }
	    }
    );
}

function getoptions( list, value )
{
    for( i = 0; i < list.length; i++ )
    {
        var a = list[i].split("=");
        document.write("<option value=");
        document.write(a[0]);
        if( value == a[0] )
           document.write(" selected");
        document.write(">");
        document.write(a[1]);
        document.write("</option>");
    }
}
function updateparam(value)
{
    if( value == 0 )
    {
        document.getElementById("rad1").style.display = "none";
        document.getElementById("rad2").style.display = "none";
        document.getElementById("rad3").style.display = "none";
    }
    else
    {
        document.getElementById("rad1").style.display = "block";
        document.getElementById("rad2").style.display = "block";
        document.getElementById("rad3").style.display = "block";
    }
}
</script>
<h2><a id="content" name="content"><%: RADIUS Configuration%></a></h2>
<div class="cbi-map">
       <form name="formTable">
          <fieldset class="cbi-section">
          <div class="cbi-section-descr"></div>
          <fieldset class="cbi-section-node">
          <div class="cbi-value">
            <label class="cbi-value-title">Status</label>
            <div class="cbi-value-field">
              <select class="cbi-input-select" name="32" onchange="updateparam(this.value)">
                 <script type="text/javascript">
                 var stat = "<%=uciget('uci get wrt-radauth.sys.enableRadAuth')%>";
                 document.write("<option value='0' ");
                 if( stat == "0" )
                     document.write(" selected");
                 document.write(">Disable</option>");
                 document.write("<option value='1' ");
                 if( stat == "1" )
                     document.write(" selected");
                 document.write(">Enable</option>");
                 </script>
              </select>
            </div>
          </div>
          </fieldset>
          </fieldset>
          <fieldset class="cbi-section" id="rad1">
          <br>
          <legend style="width:96%; padding:10px 0px 10px 0px; border-bottom:1px solid #e5e5e5;">Primary Server</legend><br><br>
          <div class="cbi-section-descr"></div>
          <fieldset class="cbi-section-node">
          <div class="cbi-value">
            <label class="cbi-value-title">Primary Server</label>
            <div class="cbi-value-field">
              <input type="text" name="33" class="cbi-input-select" value="<%=uciget('uci get wrt-radauth.sys.primaryServer')%>" >
            </div>
          </div>
          <div class="cbi-value">
            <label class="cbi-value-title">Primary Server Port</label>
            <div class="cbi-value-field">
              <input type="text" name="34" class="cbi-input-select" value="<%=uciget('uci get wrt-radauth.sys.primaryPort')%>" > &nbsp; (1-65535)
            </div>
          </div>
          <div class="cbi-value">
            <label class="cbi-value-title">Primary Shared Secret</label>
            <div class="cbi-value-field">
              <input type="password" name="35" class="cbi-input-select" value="********" >
            </div>
          </div>
          <br>
          </fieldset>
          </fieldset>
          <fieldset class="cbi-section" id="rad2">
          <legend style="width:96%; padding:10px 0px 10px 0px; border-bottom:1px solid #e5e5e5;">Secondary Server</legend><br><br>
          <div class="cbi-section-descr"></div>
          <fieldset class="cbi-section-node">
          <div class="cbi-value">
            <label class="cbi-value-title">Secondary Server</label>
            <div class="cbi-value-field">
              <input type="text" name="36" class="cbi-input-select" value="<%=uciget('uci get wrt-radauth.sys.secondaryServer')%>" >
            </div>
          </div>
          <div class="cbi-value">
            <label class="cbi-value-title">Secondary Server Port</label>
            <div class="cbi-value-field">
              <input type="text" name="37" class="cbi-input-select" value="<%=uciget('uci get wrt-radauth.sys.secondaryPort')%>" > &nbsp; (1-65535)
            </div>
          </div>
          <div class="cbi-value">
            <label class="cbi-value-title">Secondary Shared Secret</label>
            <div class="cbi-value-field">
              <input type="password" name="38" class="cbi-input-select" value="********" >
            </div>
          </div>
          <br>
          </fieldset>
          </fieldset>
          <fieldset class="cbi-section" id="rad3">
          <legend style="width:96%; padding:10px 0px 10px 0px; border-bottom:1px solid #e5e5e5;">RADIUS Parameters</legend><br><br>
          <div class="cbi-section-descr"></div>
          <fieldset class="cbi-section-node">
          <div class="cbi-value">
            <label class="cbi-value-title">Reauthentication Time</label>
            <div class="cbi-value-field">
              <input type="text" name="39" class="cbi-input-select" value="<%=uciget('uci get wrt-radauth.sys.reauthTime')%>" > &nbsp; (10-65535) sec
            </div>
          </div>
          <div class="cbi-value">
            <label class="cbi-value-title">Retry Time</label>
            <div class="cbi-value-field">
              <input type="text" name="40" class="cbi-input-select" value="<%=uciget('uci get wrt-radauth.sys.retryTime')%>" > &nbsp; (10-65535) sec
            </div>
          </div>
          <div class="cbi-value">
            <label class="cbi-value-title">Retry Count</label>
            <div class="cbi-value-field">
              <input type="text" name="41" class="cbi-input-select" value="<%=uciget('uci get wrt-radauth.sys.requestRetries')%>" > &nbsp; (1-65535)
            </div>
          </div>
          <div class="cbi-value">
            <label class="cbi-value-title">Retry Count Period</label>
            <div class="cbi-value-field">
              <input type="text" name="42" class="cbi-input-select" value="<%=uciget('uci get wrt-radauth.sys.requestTimeout')%>" > &nbsp; (1-65535) sec
            </div>
          </div>
          </fieldset>
          </fieldset>
    </form>
</div>
<div class="cbi-page-actions left">
<div id="spin"></div>
<input type="button" class="cbi-button" value="<%:Save%>" onclick="save_value()" />
</div>
<script type="text/javascript">
var stat = "<%=uciget('uci get wrt-radauth.sys.enableRadAuth')%>";
updateparam( stat );
save_def_value();
</script>
</div>
<%+footer%>
