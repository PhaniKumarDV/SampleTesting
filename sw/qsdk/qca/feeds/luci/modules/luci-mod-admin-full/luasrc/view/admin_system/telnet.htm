<%#
 Copyright 2008-2009 Steven Barth <steven@midlink.org>
 Copyright 2008-2015 Jo-Philipp Wich <jow@openwrt.org>
 Licensed to the public under the Apache License 2.0.
-%>

<%-
        function uciget(cmd)
                local res = luci.util.exec(cmd)
                local str = string.gsub(res, "\n", "")
                return str
        end
-%>
<%+header%>
<div class="page-content">
<script type="text/javascript" src="<%=resource%>/cbi.js"></script>
<script type="text/javascript">
var def = new Array(8);
function save_def_value()
{
    var f = document.formTable;
    for (i=0; i<f.elements.length; i++)
    {
        def[i] = f.elements[i].value;
    }
}

function disable_spin()
{
    document.getElementById("spin").innerHTML = "";
}

function save_value()
{
    document.getElementById("spin").innerHTML = "<i class='fa fa-spinner fa-pulse'></i>";
    setTimeout("disable_spin()",1000);
    var setdata = "";
    var f = document.formTable;
    for( i=0; i<f.elements.length; i++)
    {
        if( def[i] != f.elements[i].value ) {
            def[i] = f.elements[i].value;
            setdata += f.elements[i].name + "=" + f.elements[i].value + "~";
        }
    }
    XHR.get('<%=luci.dispatcher.build_url("admin")%>/cfg_set' + '/' + setdata, null,
	    function(x, data) {
		    if (data) { 
		    }
	    }
    );
}
function updatetelnet()
{
    if( document.getElementById("telnet2").checked == "1" )
        document.getElementById("telnet1").value = 1;
    else
        document.getElementById("telnet1").value = 0;
}
function updatessh()
{
    if( document.getElementById("ssh2").checked == "1" )
        document.getElementById("ssh1").value = 1;
    else
        document.getElementById("ssh1").value = 0;
}
</script>
<h2><a id="content" name="content"><%: Services%></a></h2>
<div class="cbi-map">
    <ul class="cbi-tabmenu">
        <li style="margin-right:4px" class="cbi-tab-disabled"><a href="<%=luci.dispatcher.build_url("admin/system/services")%>"><%:HTTP/HTTPS%></a></li>
        <li style="margin-right:4px" class="cbi-tab"><a href="#"><%:Telnet/SSH%></a></li>
        <li style="margin-right:4px" class="cbi-tab-disabled"><a href="snmp"><%:SNMP%></a></li>
    </ul>
        <h2><a id="content" name="content"><%:Telnet%></a></h2>
    <fieldset class="cbi-section">
       <form name="formTable">
          <div class="cbi-value">
            <label class="cbi-value-title">Enable Telnet</label>
            <div style="display:none"><input type="text" id="telnet1" name="98" value="<%=uciget('uci get telnetssh.telnet.status')%>"></div>
            <div class="cbi-value-field">
                 <script type="text/javascript">
                 var telnet = "<%=uciget('uci get telnetssh.telnet.status')%>";
                 document.write("<input type='checkbox' ");
                 if( telnet == 1 )
                     document.write(" checked");
                 document.write(" id='telnet2' class='cibi-input-select' onchange='updatetelnet()' >");
              </script>
            </div>
          </div>
          <div class="cbi-value" style="display:none">
            <label class="cbi-value-title">Telnet Port</label>
            <div class="cbi-value-field">
              <input type="text" name="99" class="cbi-input-select" value="<%=uciget('uci get telnetssh.telnet.port')%>" >
            </div>
          </div>
          <div class="cbi-value">
            <label class="cbi-value-title">Telnet Sessions</label>
            <div class="cbi-value-field">
              <input type="text" name="100" class="cbi-input-select" value="<%=uciget('uci get telnetssh.telnet.sessions')%>" >
            </div>
          </div>
          <h2><a id="content" name="content"><%:SSH%></a></h2>
          <div class="cbi-value">
            <label class="cbi-value-title">Enable SSH</label>
            <div style="display:none"><input type="text" id="ssh1" name="101" value="<%=uciget('uci get telnetssh.ssh.status')%>"></div>
            <div class="cbi-value-field">
                 <script type="text/javascript">
                 var ssh = "<%=uciget('uci get telnetssh.ssh.status')%>";
                 document.write("<input type='checkbox' ");
                 if( ssh == 1 )
                     document.write(" checked");
                 document.write(" id='ssh2' class='cibi-input-select' onchange='updatessh()' >");
              </script>
            </div>
          </div>
          <div class="cbi-value" style="display:none">
            <label class="cbi-value-title">SSH Port</label>
            <div class="cbi-value-field">
              <input type="text" name="102" class="cbi-input-select" value="<%=uciget('uci get telnetssh.ssh.port')%>" >
            </div>
          </div>
          <div class="cbi-value">
            <label class="cbi-value-title">SSH Sessions</label>
            <div class="cbi-value-field">
              <input type="text" name="103" class="cbi-input-select" value="<%=uciget('uci get telnetssh.ssh.sessions')%>" >
            </div>
          </div>
        </form>
        </fieldset>
</div>
<div class="cbi-page-actions left">
<div id="spin"></div>
<input type="button" class="cbi-button" value="<%:Save%>" onclick="save_value()" />
</div>
<script type="text/javascript">
save_def_value();
</script>
</div>
<%+footer%>
